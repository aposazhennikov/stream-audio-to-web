# Аудио Стриминг Сервер

Это приложение создает веб-сервер для потоковой передачи аудиофайлов в браузер. Приложение сканирует указанную директорию для поиска аудиофайлов и последовательно транслирует их через порт 9999.

## Возможности

- Автоматическое сканирование директории для поиска .mp3 и .wav файлов
- Полная поддержка Unicode и специальных символов в именах файлов
- Трансляция аудиофайлов через HTTP
- Автоматическое воспроизведение аудиопотока в браузере
- Отображение информации о текущем треке
- Автоматический переход к следующему треку после завершения воспроизведения
- Логирование ошибок в Sentry
- Контейнеризация с использованием Docker

## Архитектура проекта

Проект разделен на несколько модулей:

- `main.py` - Главный модуль приложения, инициализирует и запускает все компоненты
- `playlist_manager.py` - Сканирует директорию и управляет плейлистом аудиофайлов
- `audio_streamer.py` - Обрабатывает аудиофайлы и создает потоковый контент
- `web_server.py` - Веб-сервер для доставки аудиопотока через HTTP
- `logger.py` - Настраивает логирование и интеграцию с Sentry

## Запуск приложения

### Параметры командной строки

Приложение поддерживает следующие параметры командной строки:

- `--audio-dir` - Путь к директории с аудиофайлами (по умолчанию: /app/audio)
- `--port` - Порт для веб-сервера (по умолчанию: 9999)
- `--host` - Хост для веб-сервера (по умолчанию: 0.0.0.0)

### Локально

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Установите ffmpeg (необходим для работы с аудиофайлами):
```bash
# Для Ubuntu/Debian
sudo apt-get install ffmpeg

# Для macOS с Homebrew
brew install ffmpeg

# Для Windows с Chocolatey
choco install ffmpeg
```

3. Запустите приложение, указав директорию с аудиофайлами:
```bash
python main.py --audio-dir /путь/к/директории/с/музыкой
```

4. Откройте в браузере `http://localhost:9999` для прослушивания потока

### С использованием Docker

1. Клонируйте репозиторий и перейдите в директорию проекта:
```bash
git clone https://github.com/aposazhennikov/stream-audio-to-web.git
cd stream-audio-to-web
```

2. Соберите Docker образ:
```bash
docker build -t audio-streamer .
```

3. Запустите контейнер, примонтировав директорию с аудиофайлами:
```bash


# Запуск контейнера
docker run -d --name audio-stream-server -p 9999:9999 -v /путь/к/директории/с/музыкой:/app/audio audio-streamer
```

4. Управление запущенным контейнером:
```bash
# Просмотр логов
docker logs audio-stream-server

# Остановка контейнера
docker stop audio-stream-server

# Перезапуск контейнера
docker restart audio-stream-server
```

5. Откройте в браузере `http://localhost:9999` для прослушивания потока

## Описание модулей

### main.py
Основной исполняемый файл приложения. Обрабатывает аргументы командной строки, инициализирует логгер, менеджер плейлиста и запускает веб-сервер для трансляции аудио.

### logger.py
Настраивает систему логирования и интеграцию с Sentry для отслеживания ошибок.

### playlist_manager.py
Класс `PlaylistManager` сканирует указанную директорию для поиска MP3 и WAV файлов, создает плейлист и предоставляет методы для навигации по нему. Автоматически перемешивает файлы для разнообразного воспроизведения.

### audio_streamer.py
Класс `AudioStreamer` обрабатывает аудиофайлы и создает потоки данных для веб-трансляции. Использует библиотеку pydub для работы с аудио. Содержит специальную обработку для файлов с Unicode и специальными символами в именах.

### web_server.py
Класс `AudioStreamServer` создает веб-сервер на Flask, который обеспечивает потоковую передачу аудио в браузер. Включает HTML-шаблон для веб-интерфейса с аудиоплеером и отображением информации о текущем треке.

## Требования

- Python 3.6 или выше
- ffmpeg (для работы с аудиофайлами)
- Зависимости из файла requirements.txt
